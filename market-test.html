<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Marketplace API Test</title>
    <style>
        body { font-family: sans-serif; padding: 20px; max-width: 900px; margin: auto; }
        pre { background-color: #f0f0f0; padding: 10px; border-radius: 5px; white-space: pre-wrap; word-wrap: break-word; font-size: 14px; }
        .nft-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; }
        .nft-card { border: 1px solid #ccc; border-radius: 8px; padding: 15px; }
        .nft-card img { width: 100%; height: 250px; object-fit: cover; border-radius: 4px; }
        .nft-card h3 { margin-top: 0; }
        input { padding: 8px; font-size: 14px; }
        button { padding: 10px 15px; font-size: 16px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>Marketplace API Test Page</h1>

    <hr>
    <h2>특정 NFT 상세 정보 조회</h2>
    <div>
        <label for="tokenIdInput">조회할 Token ID:</label>
        <input type="number" id="tokenIdInput" value="1" style="width: 50px;">
        <button onclick="fetchSingleNft()">NFT 조회</button>
    </div>
    <pre id="single-nft-result">여기에 결과가 표시됩니다</pre>

    <hr>
    <h2>NFT 검색</h2>
    <div>
        <label for="searchInput">검색어:</label>
        <input type="text" id="searchInput" placeholder="NFT 이름 또는 설명 입력">
        <button onclick="searchNfts()">검색</button>
        <button onclick="fetchAllNfts()">전체 목록 보기</button>
    </div>

    <hr>
    <h2>NFT 목록</h2>
    <div id="nft-list-grid" class="nft-grid">
        </div>

    <script>
        const BACKEND_URL = 'http://localhost:5050';

        // --- HTML 요소 가져오기 (검색 관련 추가) ---
        const searchInput = document.getElementById('searchInput');
        const grid = document.getElementById('nft-list-grid');

        // --- 함수 정의 ---

        // 단일 NFT 조회 함수
        async function fetchSingleNft() { /* ...기존과 동일... */ }

        // 전체 NFT 목록 조회 함수
        async function fetchAllNfts() { /* ...기존과 동일... */ }
        
        // ⭐️ NFT 검색 함수 (새로 추가) ⭐️
        async function searchNfts() {
            const searchTerm = searchInput.value;
            if (!searchTerm) {
                alert('검색어를 입력해주세요.');
                return;
            }
            // 검색 결과를 NFT 목록 그리드에 표시합니다.
            displayNfts(`${BACKEND_URL}/api/nfts/search?q=${searchTerm}`);
        }
        
        // ⭐️ NFT 목록을 화면에 표시하는 공통 함수 (새로 추가 및 리팩토링) ⭐️
        async function displayNfts(apiUrl) {
            grid.innerHTML = '<p>NFT 목록 로딩 중...</p>';
            try {
                const response = await fetch(apiUrl);
                const data = await response.json();

                if (!response.ok) {
                    throw new Error('NFT 목록 로딩 실패');
                }

                grid.innerHTML = ''; // 로딩 메시지 제거
                if (data.nfts && data.nfts.length > 0) {
                    data.nfts.forEach(nft => {
                        const card = document.createElement('div');
                        card.className = 'nft-card';
                        card.innerHTML = `
                            <img src="${nft.imageUrl}" alt="${nft.name}">
                            <h3>${nft.name} (ID: ${nft.tokenId})</h3>
                            <p><b>Price:</b> ${nft.price} ETH</p>
                            <p><b>Creator:</b> ${nft.creator.nickname}</p>
                        `;
                        grid.appendChild(card);
                    });
                } else {
                    grid.innerHTML = '<p>표시할 NFT가 없습니다.</p>';
                }
            } catch (error) {
                grid.innerHTML = `<p>오류 발생: ${error.message}</p>`;
            }
        }

        // --- 페이지 로드 시 실행 ---
        window.onload = () => {
            // 페이지가 로드되면 자동으로 전체 NFT 목록을 불러옵니다.
            displayNfts(`${BACKEND_URL}/api/nfts`);
        };
        
        // --- 기존 함수들은 여기에 그대로 복사 ---
        async function fetchSingleNft() {
            const tokenId = document.getElementById('tokenIdInput').value;
            const resultBox = document.getElementById('single-nft-result');
            if (!tokenId) {
                resultBox.textContent = 'Token ID를 입력해주세요.';
                return;
            }
            resultBox.textContent = `Token ID ${tokenId} 조회 중...`;
            try {
                const response = await fetch(`${BACKEND_URL}/api/nfts/${tokenId}`);
                const data = await response.json();
                if (!response.ok) { throw new Error(data.message || 'NFT 조회 실패'); }
                resultBox.textContent = JSON.stringify(data, null, 2);
            } catch (error) {
                resultBox.textContent = `오류 발생: ${error.message}`;
            }
        }
        async function fetchAllNfts() {
            displayNfts(`${BACKEND_URL}/api/nfts`);
        }
    </script>
</body>
</html>